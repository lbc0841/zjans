---
title: "a647. 投資專家"
date: 2025-05-16
tags: ["浮點誤差"]
difficulty: 2
---

<font color="#ff2020">※ 注意</font><br>
題目的 keep 和 dispose 是取決於 **四捨五入前** 的結果<br>
而輸出前半段的 獲利率 是 **四捨五入後** 的結果

***

## 解法一、化成整數運算

### 🔹 浮點數誤差

一個著名的例子是 `0.1 + 0.2 != 0.3` (0.30000000000000004)<br>
浮點數誤差會導致四捨五入計算錯誤

<details class="eg" close>
<summary>2.195 四捨五入</summary>

以下代碼對 $2.195$ 四捨五入的預期結果為 $2.20$<br>
但實際上輸出卻是 $2.19$

```cpp
#include <bits/stdc++.h>
using namespace std;

int main(){
    double x = 2.195;
    cout << round(x*100)/100;
    return 0;
}
```

— — —

試著輸出到小數點後 16 位<br>
會發現 `x` 的值是 $2.1949999999999998$<br>
`x` 的誤差也就導致了後續四捨五入的計算錯誤<br>
($2.194$ 四捨五入 $= 2.19$)

```cpp
#include <bits/stdc++.h>
using namespace std;

int main(){
    double x = 2.195;
    cout << setprecision(17) << x;
    return 0;
}
```
</details>

### 🔹 用整數運算避免誤差

在整數手動完成四捨五入<br>
(x*1000 確保要小數點後三位都在整數位)

### ✅ 完整代碼

評分結果(參考) ： **<font color="#00bb00">AC</font> (3ms, 336KB)**

```cpp
#include <bits/stdc++.h>
using namespace std;

int main(){
    int n, m, p;
    cin >> n;
    for(int i=0; i<n; i++){
        scanf("%d %d", &m, &p);
        
        double x = (p-m)*100.0 / m;
        double fixed = (int)((x*1000+(x>0?5:-5)) / 10) / 100.0;

        printf("%.2f%% ", fixed);
        if(x >= 10 || x <= -7) printf("dispose\n");
        else printf("keep\n");
    }
    
    return 0;
}
```
